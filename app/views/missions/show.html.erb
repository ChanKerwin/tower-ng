<html>
  <head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
  </head>
  <body class="fill-background-color"
        id="<%= controller.controller_name %>-<%= controller.action_name %>">

    <div class="menu-eventarea"
         data-controller="comment"
         data-action="click@window->comment#onClick">
    </div>

    <%= render "layouts/loading_dialog", message: "正在删除任务..." %>
    <%= render 'layouts/header' %>
    <%= render "layouts/mission_toolbar" %>

    <%= render "layouts/confirm_dialog", dialogid: "comment-confirm-dialog", message: "确定要删除这条评论吗?", controller: "comment", action: "comment#confirmDeleteComment" %>

    <div class="mission-distributor-menu"
	 data-controller="missiondistributor">
      <ul>
	<li class="mission-distributor-menu-item-title">
	  将任务指派给
	</li>
	<li class="mission-distributor-menu-item">
	  <div class="input-group input-group-sm mb-3 mission-distributor-input-group">
            <input type="text"
		   class="form-control mission-member-input"
		   placeholder="请输入成员姓名 (或拼音)"
		   data-action="click->missiondistributor#clickMemberInput input->missiondistributor#changeMemberInput">
            <div class="input-group-btn">
              <button class="btn btn-default"
		      type="submit"
		      data-action="missiondistributor#clickMemberMenuButton">
                <span class="glyphicon glyphicon-triangle-bottom"></span>
              </button>
            </div>
          </div>
        </li>
        <li class="mission-distributor-menu-item-title">
          任务截止时间
        </li>
	<li class="mission-distributor-menu-item">
          <div class="input-group-sm">
	    <input type="text"
		   data-provide="datepicker"
		   class="form-control mission-distributor-datepicker"
                   placeholder="请选择截止日期" >
	  </div>
        </li>
      </ul>
    </div>

    <div class="mission-member-menu"
	 data-controller="missiondistributor">
      <ul>
	<% @member_array.each do |member| %>
	  <li class="mission-member-menu-item">
            <%= image_tag(member[:photo_url], width: 22, height: 22) %>
	    <div class="mission-member-name inline-block">
	      <%= member[:name] %>
	    </div>
	    <div class="mission-member-pinyin inline-block">
              <%= member[:pinyin] %>
            </div>
            <% unless member == @member_array.last %>
              <div class="splitter"></div>
            <% end %>
	  </li>
	<% end %>
      </ul>
    </div>

    <div class="comment-edit-menu arrow-menu">
      <ul>
        <li class="arrow-menu-item">
          <a href="#"
	     class="arrow-menu-item-text"
	     data-controller="comment"
	     data-action="comment#editComment">
            编辑
          </a>
        </li>
        <li class="arrow-menu-item">
          <a href="#"
             class="arrow-menu-item-text"
	     data-controller="comment"
	     data-action="comment#deleteComment">
            删除
          </a>
        </li>
      </ul>
    </div>

    <a href="#"
       class="comment-edit-button glyphicon glyphicon-align-justify"
       data-controller="comment"
       data-action="comment#clickEditButton">
    </a>

    <%= link_to project_url(@project.hashid) do %>
      <div class="bread-crumbs-big">
        <%= @project.name %>
      </div>
    <% end %>

    <div class="right-float-menu-top"></div>

    <div data-controller="mission rightfloatmenu"
         data-rightfloatmenu-top-offset="80"
         class="board-box min-board-height right-float-menu-parent">
      <%= render "layouts/confirm_dialog", dialogid: "confirm-dialog", message: "确定要删除这个任务吗?", controller: "mission", action: "mission#deleteMissionPage" %>

      <div class="right-float-menu-box">
        <div class="right-float-menu"
             data-target="rightfloatmenu.rightMenuArea"
             data-action="scroll@window->rightfloatmenu#onScroll">
          <ul class="right-float-menu-scrollarea">
            <li class="right-float-menu-item">
              <a href="#"
                 class="right-float-menu-normal-button"
                 data-action="mission#clickMissionPageEditButton">
                编辑
              </a>
            </li>
	    <% if team_administrator? %>
              <li class="right-float-menu-item">
		<a href="#"
                   class="right-float-menu-delete-button"
                   data-toggle="modal"
                   data-target="#confirm-dialog">
                  删除
		</a>
              </li>
	    <% end %>
          </ul>
        </div>
      </div>
      <%= link_to project_mission_list_url(@project.hashid, @mission_list.hashid), class: "mission-list-link" do %>
        <%= @mission_list.name %>
      <% end %>

      <li class="mission-edit-form-header">
        <div class="mission-edit-form"
             data-target="mission.missionNewForm">
          <div class="flex-vcenter">
            <label class="mission-input-line"></label>
            <input type="text"
                   class="edit-input"
                   placeholder="新的任务"
                   data-action="keydown->mission#enterMissionPageEdit">
            <button type="button" class="btn mission-distributor">未指派</button>
          </div>
          <% if @mission.summary && !@mission.summary.empty? %>
            <textarea class="mission-edit-textarea" placeholder="任务描述">
              <%= @mission.summary %>
            </textarea>
          <% else %>
            <textarea class="mission-edit-textarea" placeholder="任务描述"></textarea>
          <% end %>
          <div>
            <button class="btn-sm mission-edit-submit-button"
                    data-action="mission#clickMissionPageEditSubmitButton">
              保存
            </button>
            <a href="#"
               class="link-button-small"
               data-target="mission.missionCancelButton"
               data-action="mission#clickMissionPageEditCancelButton">
              取消
            </a>
          </div>
        </div>
      </li>

      <li id=<%= @mission.hashid %>
          class="mission-title-item margin-top-normal"
          data-action="mouseenter->mission#mouseEnterMission mouseleave->mission#mouseLeaveMission">
        <input type="checkbox" class="mission-checkbox" id=<%= @mission.hashid %>>
        <label for=<%= @mission.hashid %>
               class="mission-title">
          <span
              id=<%= @mission.hashid %>
              class="mission-big-title-link">
            <%= @mission.name %>
          </span>
        </label>
        <button type="button"
		      class="btn mission-distributor"
		      data-action="mission#changeDistributor">
	  未指派
	</button>
      </li>
      <% if !@mission.summary || @mission.summary.empty? %>
        <div class="mission-add-summary-button">
          <a href="#"
             class="btn"
             data-action="mission#clickMissionPageEditButton">
            添加任务描述
          </a>
        </div>
      <% end %>
      <span class="mission-summary">
        <%= @mission.summary %>
      </span>

      <div class="mission-comment-splitter"></div>

      <%= render "comments/create_comment_list", mission: @mission %>

      <div class="comment-edit-form-wrap">
	<div class="mission-comment-edit-icon">
          <%= image_tag current_user.avatar_url %>
	</div>
	<div>
	  <textarea class="mission-comment-textarea"
                    placeholder="点击发表评论"
                    data-action="mouseup->mission#clickCommentArea"></textarea>

	  <div class="mission-comment-button-area">
	    <button class="btn-sm mission-comment-submit-button"
                    data-action="mission#clickCommentSubmitButton">
              发表评论
            </button>
            <a href="#"
               class="link-button-small"
               data-target="mission.missionCancelButton"
               data-action="mission#clickCommentCancelButton">
              取消
            </a>
	  </div>
	</div>
      </div>
    </div>

  </body>
</html>
